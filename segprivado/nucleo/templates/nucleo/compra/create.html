{% extends 'index.html' %}

{% block title %}Farmacia | SegPrivado{% endblock %}

{% block content %}
<section class="page-head">
    <div>
        <h1 class="page-title">Farmacia</h1>
    </div>
</section>

<section class="grid-two">
    <div class="stack">
        <section class="content-card">
            <h2 class="dashboard-card__title section-heading">Medicamentos</h2>
            <div class="table-wrap">
                <table>
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Detalle</th>
                            <th>Precio</th>
                            <th>Stock</th>
                            <th class="table-col--action">Agregar</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for m in medicamentos %}
                        <tr>
                            <td>{{ m.nombre }}</td>
                            <td>{{ m.descripcion }}</td>
                            <td>{{ m.precio }}</td>
                            <td>{{ m.stock }}</td>
                            <td class="cell-actions"><a class="button button--secondary button--tight" href="{% url 'nucleo:addMedicamento' pk=m.id %}">Agregar</a></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>

        <section class="content-card">
            <h2 class="dashboard-card__title section-heading">Carrito</h2>
            <div class="table-wrap">
                <table>
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Precio</th>
                            <th>Cantidad</th>
                            <th>Total</th>
                            <th class="table-col--action">Ajustar</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for c in carrito %}
                        <tr>
                            <td>{{ c.nombre }}</td>
                            <td>{{ c.precio }}</td>
                            <td>{{ c.cantidad }}</td>
                            <td>{{ c.acumulado }}</td>
                            <td class="cell-actions">
                                <div class="button-row">
                                    <a class="button button--secondary button--tight button--icon" href="{% url 'nucleo:addMedicamento' pk=c.id %}">+</a>
                                    <a class="button button--secondary button--tight button--icon" href="{% url 'nucleo:restarMedicamento' pk=c.id %}">-</a>
                                    <a class="button button--danger button--tight" href="{% url 'nucleo:removeMedicamento' pk=c.id %}">Quitar</a>
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5">Sin productos.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="button-row button-row--top">
                <a class="button button--secondary" href="{% url 'nucleo:limpiarCarrito' %}">Vaciar</a>
            </div>
        </section>
    </div>

    <section class="content-card">
        <h2 class="dashboard-card__title section-heading">Compra</h2>
        <form method="post" enctype="multipart/form-data" class="form-grid">
            {% csrf_token %}
            {% if form.non_field_errors %}
            <div class="form-errors">
                {% for error in form.non_field_errors %}
                <div class="field-error">{{ error }}</div>
                {% endfor %}
            </div>
            {% endif %}
            <div class="field-group">
                <label for="{{ form.fecha.id_for_label }}">{{ form.fecha.label }}</label>
                {{ form.fecha }}
                {% if form.fecha.errors %}
                <div class="field-errors">
                    {% for error in form.fecha.errors %}
                    <div class="field-error">{{ error }}</div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            <div class="field-group">
                <label>Paciente</label>
                <input type="text" value="{{ user.first_name }} {{ user.last_name }}" disabled>
            </div>
            <div class="field-group">
                <label for="{{ form.precio.id_for_label }}">{{ form.precio.label }}</label>
                {{ form.precio }}
                {% if form.precio.errors %}
                <div class="field-errors">
                    {% for error in form.precio.errors %}
                    <div class="field-error">{{ error }}</div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            <div class="button-row">
                <button type="submit" class="button button--primary">Guardar</button>
            </div>
        </form>
    </section>
</section>
{% endblock %}
