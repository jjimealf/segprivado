{% extends 'index.html' %}

{% block title %}Perfil | SegPrivado{% endblock %}

{% block content %}
<section class="page-head">
    <div>
        <h1 class="page-title">Perfil</h1>
    </div>
</section>
<section class="content-card">
    <form method="post" enctype="multipart/form-data" class="form-grid">
        {% csrf_token %}
        <div class="profile-media">
            {% if request.user.foto %}
            <img class="profile-media__image" src="{{ request.user.foto.url }}" alt="{{ user.username }}">
            {% else %}
            <div class="profile-media__avatar" aria-hidden="true">
                {% if user.first_name or user.last_name %}
                {{ user.first_name|slice:":1"|upper }}{{ user.last_name|slice:":1"|upper }}
                {% else %}
                {{ user.username|slice:":1"|upper }}
                {% endif %}
            </div>
            {% endif %}
            <div class="profile-media__meta">
                <span class="profile-media__label">Foto actual</span>
                <span class="profile-media__value">{% if request.user.foto %}Cargada{% else %}Sin foto{% endif %}</span>
                <span class="profile-media__hint">Puedes subir una nueva imagen desde este formulario.</span>
            </div>
        </div>
        {% if form.non_field_errors %}
        <div class="form-errors">
            {% for error in form.non_field_errors %}
            <div class="field-error">{{ error }}</div>
            {% endfor %}
        </div>
        {% endif %}
        {% for field in form %}
        <div class="field-group">
            <label for="{{ field.id_for_label }}">{{ field.label }}</label>
            {{ field }}
            {% if field.name == "foto" %}
            <div class="field-help">JPG, PNG o WEBP. La nueva imagen reemplaza la actual al guardar.</div>
            {% endif %}
            {% if field.help_text %}
            <div class="field-help">{{ field.help_text }}</div>
            {% endif %}
            {% if field.errors %}
            <div class="field-errors">
                {% for error in field.errors %}
                <div class="field-error">{{ error }}</div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        {% endfor %}
        <div class="button-row">
            <button type="submit" class="button button--primary">Guardar</button>
            <a class="button button--secondary" href="{% url 'nucleo:home' %}">Panel</a>
        </div>
    </form>
</section>
{% endblock %}
